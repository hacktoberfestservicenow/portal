<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($window, $scope) {
    /* widget controller */
    var c = this;

    c.createRecord = function() {


        var dayHours;
        var start;
        var end;
        var startValue;
        var endValue;

        function calculateTime() {
            // get time inputs
            var startTime = document.getElementById('timeStart');
            var endTime = document.getElementById('timeEnd');

            startValue = startTime.value;
            endValue = endTime.value;

            // Parse the time strings into Date objects
            var startParts = startValue.split(':');
            var endParts = endValue.split(':');

            // Create Date objects with today's date and the parsed hour and minute values
            var startDate = new Date();
            startDate.setHours(parseInt(startParts[0], 10));
            startDate.setMinutes(parseInt(startParts[1], 10));
            start = startParts;
            var endDate = new Date();
            endDate.setHours(parseInt(endParts[0], 10));
            endDate.setMinutes(parseInt(endParts[1], 10));
            end = endParts;
            // Calculate the difference in milliseconds
            var differenceMs = endDate - startDate;

            // Convert milliseconds to hours and minutes
            var differenceHours = Math.floor(differenceMs / (1000 * 60 * 60));
           // var differenceMinutes = Math.floor((differenceMs % (1000 * 60 * 60)) / (1000 * 60));


            dayHours = differenceHours;

            //console.log(totalTime);
        }

        calculateTime();

        // Create a new Date object representing the current date
        var currentDate = c.data.date;
        //var currentEnd = c.data.endDate
        // Add one day to the current date
        currentDate.setDate(currentDate.getDate() + 1);
        //currentEnd.setDate(currentEnd.getDate() + 1);
        c.data.weekNumber = document.getElementById('weekN').value;;
        c.data.hours = dayHours;
        c.data.startTime = document.getElementById('timeStart').value;
        c.data.endTime = document.getElementById('timeEnd').value;
        c.data.date = currentDate;

        //c.data.startDate = currentStart;
        //c.data.endDate = currentEnd;
        //console.log( document.getElementById('dropdown').value)
        c.data.title = document.getElementById('dropdown').value;

        c.data.action = "ACTION";
        c.server.update();
        $window.location.reload();


    }


};]]></client_script>
        <controller_as>c</controller_as>
        <css>.widget-container {&#13;
  width: 300px;&#13;
  border: 1px solid #ccc;&#13;
  border-radius: 5px;&#13;
  padding: 10px;&#13;
  margin-top: 50px&#13;
}&#13;
&#13;
.widget-header, .startEndDate {&#13;
  display: flex;&#13;
  justify-content: space-between;&#13;
  align-items: center;&#13;
  margin-bottom: 10px;&#13;
}&#13;
&#13;
input{&#13;
  &#13;
  font-size: 14px;&#13;
  &#13;
  cursor: pointer;&#13;
}&#13;
&#13;
/* Dropdown Button */&#13;
select {&#13;
  background-color: grey;&#13;
  color: grey;&#13;
  padding: 5px;&#13;
  width: 150px;&#13;
  font-size: 16px;&#13;
  border: none;&#13;
  cursor: pointer;&#13;
}&#13;
&#13;
/* Dropdown button on hover &amp; focus */&#13;
select:hover, .dropbtn:focus {&#13;
  background-color: white;&#13;
}&#13;
&#13;
/* The container &lt;div&gt; - needed to position the dropdown content */&#13;
.dropdown {&#13;
  position: relative;&#13;
  display: inline-block;&#13;
  margin-bottom:50px;&#13;
}&#13;
&#13;
/* Dropdown Content (Hidden by Default) */&#13;
.dropdown-content {&#13;
 // display: none;&#13;
  position: absolute;&#13;
  background-color: #f1f1f1;&#13;
  padding: 5px;&#13;
  font-size: 14px;&#13;
  border: none;&#13;
  cursor: pointer;&#13;
}&#13;
&#13;
/* Links inside the dropdown */&#13;
.dropdown-content option {&#13;
  color: black;&#13;
  padding: 5px;&#13;
  text-decoration: none;&#13;
  display: block;&#13;
  cursor: pointer;&#13;
}&#13;
&#13;
/* Change color of dropdown links on hover */&#13;
.dropdown-content option:hover {background-color: #ddd;}&#13;
&#13;
&#13;
&#13;
.add-button {&#13;
  background-color: #4caf50;&#13;
  color: #fff;&#13;
  border: none;&#13;
  border-radius: 5px;&#13;
  padding: 5px;&#13;
  font-size: 14px;&#13;
  cursor: pointer;&#13;
}&#13;
&#13;
.add-button:hover {&#13;
  background-color: #45a049;&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>timesheet_creator</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Timesheet Creator</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	
   
	

	if(input && input.action=='ACTION'){
		data.weekNR = input.weekNumber;
		var currentUser = gs.getUser(); 
		gs.addInfoMessage("Total hours: " + input.startTime);
		//gs.addInfoMessage("Type: " + input.title);
		var insertTS = new GlideRecord("x_1122097_timeshee_timesheets");
		insertTS.initialize();
		insertTS.card = input.title;
		insertTS.employee = currentUser.getID();
		insertTS.date = input.date;
		insertTS.start_time = input.startTime;
		insertTS.end_time = input.endTime;
		insertTS.hours = input.hours;
		insertTS.state = "Submitted";
		
		var weekNumberDate = new GlideDateTime(data.weekNR);
		
		insertTS.week_number = weekNumberDate.getWeekOfYearLocalTime();
		if(input.title != "? undefined:undefined ?" && input.date != null &&  input.startTime != null && input.endTime != null && input.hours != null){
			insertTS.insert();
		}
		
	}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-02-14 15:19:34</sys_created_on>
        <sys_id>800595622f9002108eddfe7cf699b615</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>Timesheet Creator</sys_name>
        <sys_package display_value="Timesheet Widgets" source="x_1122097_timeshee">7e2391ee2f5002108eddfe7cf699b6e1</sys_package>
        <sys_policy/>
        <sys_scope display_value="Timesheet Widgets">7e2391ee2f5002108eddfe7cf699b6e1</sys_scope>
        <sys_update_name>sp_widget_800595622f9002108eddfe7cf699b615</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-02-14 15:36:17</sys_updated_on>
        <template><![CDATA[<div class="widget-container">
  <div class="widget-header">
    <div class="dropdown">
      
      <select id="dropdown" class="dropdown-content" ng-model="c.data.title">
        <option>Work Remote</option>
        <option >Work At Office</option>
        <option >Work At Client</option>
      </select>
    </div>
  </div>
  <div class="widget-body">
    <div class="startEndDate">
      <div>
        <span>Date:</span>
        <input type="date" ng-model="c.data.date" id="weekN">
      </div>

    </div>
    
        <div class="startEndDate" ng-model="c.data.total">
      <div>
        <span>Start hour:</span>
        <input id="timeStart" type="time" ng-model="c.data.startTime">
      </div>

      <div>
        <span>End hour:</span>
        <input id="timeEnd" type="time" ng-model="c.data.endTime">
      </div>

    </div>

    <button class="add-button" ng-click="c.createRecord()">Add</button>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
